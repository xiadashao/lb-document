# 

#  

#                                    **联邦在线数仓架构**

##                                                   **规划概要**



**  
**



# 1.前言

## 1.1背景

联帮在线通过互联网＋硬件＋内容三位一体，革新引领中国学前教育发展，实现“在园，在家同步教育”，全方位助力孩子连接世界，拥有美好未来。

## 1.2目的

本系统目的在于实现通过数据驱动业务快速发展。

## 1.3读者范围

前台后台系统开发人员，数据组开发人员

## 1.4版本信息

| 版本 | 内容变更 | 作者 | 日期 |
| :--- | :--- | :--- | :--- |
| 1.0 | 创建 | 大数据组 | 2018.09.14 |
|  |  |  |  |





# 2.数据仓库结构设计

## 2.1整体结构

![](file:///C:/Users/JK/AppData/Local/Temp/msohtmlclip1/01/clip_image002.gif "1536927894\(1\)")



本架构整体分为数据源层、ODS层、主题层和报表层。其中数据源层是从业务生产系统直接同步的数据，和生产环境数据一致；ODS和主题层数据来源于数据源层；报表层的报表和数据分析主要来源于主题层的统计和分析，对外数据服务来源于主题层和ODS，其中ODS对外服务主要提供具体业务查询减轻业务生产系统压力。

## 2.2数据源层

当前在系统中数据源层已经包含的数据有，ERP系统数据、CRM部分数据和TMS测试表。



TMS系统数据同步部分：

![](file:///C:/Users/JK/AppData/Local/Temp/msohtmlclip1/01/clip_image004.jpg)

ERP系统数据同步部分：

![](file:///C:/Users/JK/AppData/Local/Temp/msohtmlclip1/01/clip_image006.jpg)

原ERP1.0系统中，只导入了部分需要的数据，后期会将这部分功能放入CRM系统中，业务逻辑及数据结构会改变，需重新规划。

## 2.3ODS层



ODS层是数据仓库的一个可选部分，在本系统中ODS层数据主要存储对数据来源层轻度加工后的数据。轻度加工包括去除冗余数据，更改数据来源层数据编码格式，以及NULL值和特殊值得处理。对数据仓库外部提供查询服务，对数据仓库内部提供符合数据仓库数据标准的数据查询。



 ODS中相关联的ERP的数据：

![](file:///C:/Users/JK/AppData/Local/Temp/msohtmlclip1/01/clip_image008.jpg)





## 2.4主题层

主题层是数据仓库的核心，在本系统中目前规划的主题有：

渠道、财务、产品、客户、销售、事件、地域等。从数据源层和ODS层抽取数据加工成符合数据仓库规范的数据，并将数据划分到不同的主题下，形成不同的主题域。



订单相关表：

![](file:///C:/Users/JK/AppData/Local/Temp/msohtmlclip1/01/clip_image010.jpg)

销售套餐相关：

![](file:///C:/Users/JK/AppData/Local/Temp/msohtmlclip1/01/clip_image012.jpg)



## 2.5报表层

报表层主要是在主题层基础上进行报表加工和数据分析，另外还对外部提供数据服务，例如报表查询，数据导出等服务。



# 3.数据治理及ETL开发

## 3.1元数据管理

### 3.1.1技术元数据

技术元数据在本系统中包括：数据仓库分层信息、数据仓库域信息、维度元数据，ETL调度信息，本系统要逐渐建设这些技术相关的元数据信息表。具体建设方式，是在数据仓库各层建设适当的元数据表，便于技术人员和系统操作人员查询和使用。

### 3.1.2业务元数据

各个业务维度和字典信息，目前包括：产品信息，套餐信息，销售单元信息，地区信息，园所信息，销售部门信息等和业务相关的元数据。在本数仓中要逐渐统一和完善这些业务相关的元数据信息。



## 3.2ETL工具及调度

ETL工具和调度，本系统采用阿里云系统套件，调度和运维在此不做特殊介绍。



# 4.数据开发规范

## 4.1数据仓库分层方式

目前数据仓库分层采用表目录方式，

前期同步到阿里云的源数据未划分目录，所以未划分目录的表标识源数据层。

ODS目录下存放的表表示ODS层。

dw\_rpt目录下存放的表表示报表层的表。

dw\_subj目录下存放的表表示主题层的表。

## 4.2主题域命名

主题域的表命名方式，aaa\_\*表示以aaa\_开头命名的表

销售域表命名方式lb\_sell\_\*

地区域表命名方式lb\_area\_\*

产品域表命名方式lb\_product\_\*

渠道域表命名方式lb\_channel\_\*



## 4.3脚本和任务的命名

1）ETL脚本和调度任务的命名应符合相应的命名规范。

在不同层的表数据加工任务存放在不同的目录下，目录命名方式：

lb\_层\_job

例如：lb\_subj\_job目录表示主题层调度任务目录。



2）开发脚本也遵循相应规范放在相对应目录下。

例如：lb\_dw\_subj\_script表示主题层开发脚本目录。

## 4.4表设计规范

### 4.4.1ODS层表设计规范

主要采用一般关系型数据库表设计模式，复合3NF,即复合数据库设计三级范式。

### 4.4.2主题层和报表层设计规范

主要采用星型模式或星座模式以及特殊的宽表模式。



## 4.5其他规范

参见阿里开发文档。







# 5.未来规划模块

数据稽核，核验数据准确性和正确性。







