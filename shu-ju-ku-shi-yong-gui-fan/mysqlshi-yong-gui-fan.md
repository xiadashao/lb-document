## MYSQL使用规范

### 一、**表设计**

```
1、库名取值要与服务业务模块名称对应,具体是公司简拼+模块名称,例如TMS服务，数据库为lb_tms。
2、表取值为公司简拼+模块名称+具体业务表名,例如财务服务账号，数据库为lb_finance_account。
3、表和字段名一定要规范的加上注释，方便后期维护。
4、库名、表名、字段名必须使用小写字母，“_”分割。
5、库名、表名、字段名不超过20个字符。
6、库名、表名、字段名见名知意,建议使用名词而不是动词。
7、整形定义中不添加长度，比如使用INT，而不是INT(4)。
8、VARCHAR(N)，N表示的是字符数不是字节数，比如VARCHAR(255)，可以最大可存储255个汉字，需要根据实际的宽度来选择N，N尽可能小。
9、表字符集选择UTF8。
10、建议字段定义为NOT NULL。
11、禁止在数据库中使用VARBINARY、BLOB存储图片、文件等。
12、存储日期使用DATE类型。
13、存储时间（精确到秒）建议使用TIMESTAMP类型，因为TIMESTAMP使用4字节，DATETIME使用8个字节。
14、id(特殊情况用id自增，无特殊情况可用uuid转数值)
15、必备字段 id、is_delete(逻辑删除标识,防止数据无故丢失)、create_time(后管平台创建必须带)、update_time(后管平台创建必须带)、create_user(后管平台创建必须带)、update_user(后管平台创建必须带)
16、表必须设置主键
17、金额字段使用DECIMAL，不要使用int、float和double
18、同一系统中同意字段不要用多个，例如：一个表user_id，一个表member_id, 同意思不同字段，前端不能重复使用对象，需要为这个现象做兼容
19、尽量不要出现null，可设置默认值
20、合理使用唯一键/组合键，增加接口幂等性，减少脏数据产生
21、用整数不用varchar能用短的varchar不用长的varchar
22、表结构变更及时通知夏康维护线上表。
```

### 二、索引

```
1、非唯一索引必须按照“idx_字段名称_字段名称[_字段名]”进行命名。
2、唯一索引必须按照“uniq_字段名称_字段名称[_字段名]”进行命名。
3、索引名称必须使用小写。
4、ORDER BY，GROUP BY，DISTINCT的字段需要添加在索引的后面
5、UPDATE、DELETE语句需要根据WHERE条件添加索引。
6、不建议使用%前缀模糊查询，例如LIKE “%weibo”。
7、合理创建联合索引（避免冗余），(a,b,c) 相当于 (a) 、(a,b) 、(a,b,c)。
8、索引设置到区分度大的字段上，例如：sex：1(男) 0(女) 即使设置索引，性能提升很不明显，并且占用多余空间，浪费插入操作性能

```

#### **三、 SQL语句**

```
1、SQL语句中IN包含的值不应过多。
2、WHERE条件中必须使用合适的类型，避免MySQL进行隐式类型转化。
3、SELECT语句只获取需要的字段 。
4、SELECT、INSERT语句必须显式的指明字段名称，不使用SELECT *，不使用INSERTINTO table()。
5、WHERE条件中的非等值条件（IN、BETWEEN、<、<=、>、>=）会导致后面的条件使用不了索引。
6、避免在SQL语句进行数学运算或者函数运算，容易将业务逻辑和DB耦合在一起
7、使用合理的SQL语句减少与数据库的交互次数。
8、统计表中记录数时使用COUNT(*)，而不是COUNT(primary_key)和COUNT(1)。
9、避免使用过多的JOIN，同时使用join要注意join的数量。
10、SQL不要用多表关联的JOIN操作，尤其2个以上的表。后期数据量增长较快，做拆分优化时，如果有大量JOIN操作，需要改动大量语句和逻辑代码。对于需要JOIN操作可改成如下方案：1. 多条单条SQL语句执行；2. 使用IN操作，IN查询使用最佳ID字段，mysql使用ID(聚集索引)查询性能好，ID个数控制在20以内；3. 使用JOIN操作的一边表的数据量小并且不频繁改表可使用JOIN操作
11、对于确保查询或删除只有一条的数可以在where limit=1

```



